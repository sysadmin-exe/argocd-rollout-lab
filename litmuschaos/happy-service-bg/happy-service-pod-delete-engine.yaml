apiVersion: litmuschaos.io/v1alpha1
kind: ChaosEngine
metadata:
  name: happy-service-pod-delete
  namespace: happy-service-bg
  labels:
    chaos: enabled
spec:
  engineState: stop                 # set to 'stop' to pause via Git and 'active' to run
  annotationCheck: 'true'             # require app annotation as extra guard
  jobCleanUpPolicy: delete
  appinfo:
    appns: happy-service-bg
    applabel: app=happy-blue-green
    appkind: rollout
  chaosServiceAccount: happy-litmus-admin
  experiments:
    - name: happy-pod-delete
      spec:
        components:
          env:
            - name: TARGET_PODS
              value: ''             # leave empty to select via label
            - name: PODS_AFFECTED_PERC
              value: ''
            - name: TOTAL_CHAOS_DURATION
              value: '60'
            - name: CHAOS_INTERVAL
              value: '10'
            - name: FORCE
              value: 'false'
          resources: {}	
          statusCheckTimeouts: {}
        # Add steady-state probes (HTTP/Prometheus) to gate success/failure
        probe:
          - name: happy-liveness
            type: "httpProbe"
            mode: "Edge"               # The probe will check hypothesis both before and after the Test.
            runProperties:
              probeTimeout: 5s
              retry: 2
              interval: 5s
              initialDelay: 1s
              attempt: 3
              stopOnFailure: true
            httpProbe/inputs:
              url: "http://happy-blue-green-active.happy-service-bg.svc.cluster.local:5000/ping"
              insecureSkipVerify: false
              method: 
                get:
                  criteria: "=="
                  responseCode: "200"
